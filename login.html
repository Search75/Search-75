<!doctype html>
<html lang="bn">
<head> 
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Search • Login</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  background:radial-gradient(900px 500px at -10% -10%,#1a2b6655,transparent),
  linear-gradient(180deg,#070b18,#0b1220);
  color:#e9eef7;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
.card{width:min(520px,96%);background:#0f1830;border:1px solid #1e2a4b;border-radius:16px;overflow:hidden;box-shadow:0 20px 60px #0007}
header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:linear-gradient(90deg,#0f1e45,#0a1533);border-bottom:1px solid #1e2a4b}
.brand{display:flex;gap:10px;align-items:center;font-weight:800}
.logo{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,#6c9ef8,#3754ff)}
main{padding:18px}
.field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
input{background:#0b1430;border:1px solid #20315c;color:#e9eef7;padding:11px;border-radius:10px;outline:none}
input:focus{border-color:#3c64ff;box-shadow:0 0 0 3px #3c64ff33}
.btn{background:linear-gradient(180deg,#3d6bff,#2f58e8);color:#fff;border:none;padding:11px 14px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 8px 18px #2f58e855}
.btn.ghost{background:#0b1430;border:1px solid #243869;color:#cfe0ff;box-shadow:none}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.note{font-size:12px;opacity:.9}
.success{color:#8ef1d2}
.error{color:#ffb3b3}
.otp{display:none;margin-top:10px;padding:10px;border:1px dashed #2a3d77;border-radius:10px;background:#0b1430}
.otp.show{display:block}
.fade{animation:fade .35s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}
</style>
</head>
<body>
<div class="card fade">
  <header>
    <div class="brand"><div class="logo"></div>Search • Login</div>
    <a class="btn ghost" href="signup.html">Sign up</a>
  </header>
  <main>
    <div class="field"><label>Email</label><input id="e" type="email" placeholder="ex: john@mail.com"></div>
    <div class="field"><label>Password</label><input id="p" type="password" placeholder="••••••"></div>
    <div class="actions">
      <button class="btn" id="login">Login</button>
      <a class="note" href="reset.html">Forgot password?</a>
      <span class="note" id="msg"></span>
    </div>
    <div class="otp" id="otpBox">
      <div class="note">OTP: <b id="otpShow"></b></div>
      <div class="field"><label>Enter OTP</label><input id="otpin" type="number" placeholder="6-digit"></div>
      <div class="actions">
        <button class="btn" id="verify">Verify & Continue</button>
        <span class="note" id="otpMsg"></span>
      </div>
    </div>
  </main>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyCEIZmnV6vlnDHuXkR55czI7ZaNmDndRSk",
  authDomain: "search-75.firebaseapp.com",
  projectId: "search-75",
  storageBucket: "search-75.firebasestorage.app",
  messagingSenderId: "1080878455131",
  appId: "1:1080878455131:web:87e15a4e2c1cb02ecb227e",
  measurementId: "G-YGLHPK8DHW"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

/* EmailJS init */
(function(){emailjs.init("YOUR_PUBLIC_KEY");})(); // ← এখানে public key বসাও

const ttl=5*60*1000, now=()=>Date.now(), rnd=()=>Math.floor(100000+Math.random()*900000)+"";
let pend=null;
function say(el,txt,ok=true){el.textContent=txt;el.className="note "+(ok?"success":"error")}

/* Login */
document.getElementById("login").onclick=async ()=>{
  const email=e.value.trim().toLowerCase(), pass=p.value;
  const msg=document.getElementById("msg");

  if(!/^\S+@\S+\.\S+$/.test(email)) return say(msg,"ইমেইল সঠিক নয়",false);

  const snap=await db.collection("users").where("email","==",email).limit(1).get();
  if(snap.empty) return say(msg,"এই ইমেইলে কোন অ্যাকাউন্ট নেই",false);
  const user=snap.docs[0].data();

  if(user.password!==pass) return say(msg,"পাসওয়ার্ড ভুল",false);

  // OTP পাঠানো হবে
  const code=rnd();
  pend={username:user.username,email:user.email,code,exp:now()+ttl};

  document.getElementById("otpShow").textContent=code;
  emailjs.send("service_f7f5yet","template_new",{
    to_email:user.email, otp_code:code, to_name:user.username
  }).then(()=>say(msg,"OTP পাঠানো হয়েছে"))
    .catch(()=>say(msg,"OTP পাঠানো ব্যর্থ",false));

  document.getElementById("otpBox").classList.add("show");
};

/* Verify OTP */
document.getElementById("verify").onclick=()=>{
  const code=otpin.value.trim(), otpMsg=document.getElementById("otpMsg");
  if(!pend) return;
  if(now()>pend.exp) return say(otpMsg,"OTP মেয়াদ শেষ",false);
  if(code!==pend.code) return say(otpMsg,"ভুল OTP",false);

  localStorage.setItem("search_current_user",pend.username);
  location.href="app.html";
};
</script>
</body>
</html>